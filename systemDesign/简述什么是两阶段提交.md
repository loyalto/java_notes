二阶段提交指在事务提交时所有节点保持一致性。在分布式系统中，每个节点虽然可以知晓自己操作是否成功，但无法知道其他节点操作是否成功，当跨多个节点时，为了保持一致性，需要引入一个协调者来统一掌握是否提交事务。总结为：参与者将执行结果告诉协调者，协调者根据总体情况，告诉所有参与者是回滚还是提交。
### 第一阶段：投票
1. 协调者想所有参与者发送事务请求，并等待返回结果
2. 参与者接收到请求，执行但不提交，记录日志
3. 参与者反馈自己执行情况给协调者，阻塞等待后续指令
### 第二阶段：提交执行
1. 协调者从所有参与者获取到效应，并都为成功
  1. 协调者发送 commit 通知
  2. 参与者收到 commit 后，提交事务，并释放资源
  3. 参与者返回 commit 结果给协调者
2. 任一参与者响应失败或者协调者发送消息后等待超时
  1. 协调者发送回滚通知
  2. 参与者收到回滚通知后，回滚事务，并释放资源
  3. 参与者返回回滚结果给协调者
### 缺点
- 单点问题：协调者发生故障，参与者一直阻塞下去
- 同步阻塞：两阶段执行过程中，所有节点都是事务阻塞
- 数据不一致：二阶段时，发送 commit 通知，网络问题导致只有一部分参与者接收到并执行，其余参与者就一直阻塞在二阶段，导致数据不一致

可以引入超时机制（协调者等待超时算失败）与互询机制（参与者等待超时询问其他参与者事务状态）一定程度解决上面问题

### 参考
- [分布式事务：两阶段提交与三阶段提交](https://segmentfault.com/a/1190000012534071)
- [二阶段提交](https://zh.wikipedia.org/wiki/%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4)

